t <- out[[paste(sample$gcm[j])]]$cumimp.global[,c("year", paste0(sample$boot[j]))]
t2 <- data.frame(year=(max(t$year)+1):2020, temp=NA)
names(t2) <- names(t)
rbind(t,t2)
})
sample$gcm
sample$gcm[1]
out[["BCC-CSM2-MR"]]
out[[1]]$impacts$`BCC-CSM2-MR`$cumimp.global[,1962,3]
out[[1]]$impacts$`BCC-CSM2-MR`$cumimp.global[,1962]
out[[1]]$impacts$`BCC-CSM2-MR`$cumimp.global
out[[1]]$impacts$`BCC-CSM2-MR`$cumimp.global[,1962]
out[[1]]$impacts$`BCC-CSM2-MR`$cumimp.global$1962
out[[1]]$impacts$`BCC-CSM2-MR`$cumimp.global$6
out[[1]]$impacts$`BCC-CSM2-MR`$cumimp.global[[6]]
out[[1]]$impacts$`BCC-CSM2-MR`$cumimp.global[,c("year", 6)]
out[[1]]$impacts$`BCC-CSM2-MR`$cumimp.global[,c("year", 5)]
cumimp_line_975
d_line_634 <- readRDS("~/environmental_bayesian_modeling/data/ortiz-bobea/data2/d_line_634.RDS")
d_line_634
max.print(20000)
d_line_634[-1]
ccdata[[1]]$`BCC-CSM2-MR`$`hist-nat`
cumimp_line_975
gcms
library(rjags)
library(coda)
library(tidyr)
library(data.table)
burke.data <- read.csv("environmental_bayesian_modeling/data/burke/data/input/GrowthClimateDataset.csv",header=TRUE)
burke.data <- burke.data %>% drop_na(c('growthWDI','UDel_temp_popweight','UDel_precip_popweight'))
# TODO: remove countries with no climate data
# TODO: add gradual effects
countries <- burke.data[,1]
years <- burke.data[,2]
gdp <- burke.data[,11]
temp <- burke.data[,28]
precip <- burke.data[,29]
grad_effects <- transpose(burke.data[, grep(pattern ='X_yi_*', names(burke.data))])
grad_effects_2 <- transpose(burke.data[, grep(pattern ='X_y2_*', names(burke.data))])
data_len <- dim(burke.data)[1]
num_countries <- length(unique(countries))
num_years <- length(unique(years))
grad_effects_len <- dim(grad_effects)[1]
gcountries_encoded <- as.integer(factor(countries))
years_encoded = as.integer(factor(years))
reg_grad_effects <- matrix(0,data_len,grad_effects_len)
reg_grad_effects_2 <- matrix(0,data_len,grad_effects_len)
jags <- jags.model(
"environmental_bayesian_modeling/JAGS/burke_hierarchical_model.txt",
data = list(
'temp_x'=temp,
'precip_x'=precip,
'gdp_y'=gdp,
'n'=data_len,
'm'=num_countries,
'o'=num_years,
'p'=grad_effects_len,
'countries'=countries_encoded,
'year'=years_encoded,
'grad_effects_data'=grad_effects,
'grad_effects_2_data'=grad_effects_2,
'reg_grad_effects'=reg_grad_effects,
'reg_grad_effects_2'=reg_grad_effects_2
)
)
library(rjags)
library(coda)
library(tidyr)
library(data.table)
burke.data <- read.csv("environmental_bayesian_modeling/data/burke/data/input/GrowthClimateDataset.csv",header=TRUE)
burke.data <- burke.data %>% drop_na(c('growthWDI','UDel_temp_popweight','UDel_precip_popweight'))
# TODO: remove countries with no climate data
# TODO: add gradual effects
countries <- burke.data[,1]
years <- burke.data[,2]
gdp <- burke.data[,11]
temp <- burke.data[,28]
precip <- burke.data[,29]
grad_effects <- transpose(burke.data[, grep(pattern ='X_yi_*', names(burke.data))])
grad_effects_2 <- transpose(burke.data[, grep(pattern ='X_y2_*', names(burke.data))])
data_len <- dim(burke.data)[1]
num_countries <- length(unique(countries))
num_years <- length(unique(years))
grad_effects_len <- dim(grad_effects)[1]
countries_encoded <- as.integer(factor(countries))
years_encoded = as.integer(factor(years))
reg_grad_effects <- matrix(0,data_len,grad_effects_len)
reg_grad_effects_2 <- matrix(0,data_len,grad_effects_len)
jags <- jags.model(
"environmental_bayesian_modeling/JAGS/burke_hierarchical_model.txt",
data = list(
'temp_x'=temp,
'precip_x'=precip,
'gdp_y'=gdp,
'n'=data_len,
'm'=num_countries,
'o'=num_years,
'p'=grad_effects_len,
'countries'=countries_encoded,
'year'=years_encoded,
'grad_effects_data'=grad_effects,
'grad_effects_2_data'=grad_effects_2,
'reg_grad_effects'=reg_grad_effects,
'reg_grad_effects_2'=reg_grad_effects_2
)
)
library(rjags)
library(coda)
library(tidyr)
library(data.table)
burke.data <- read.csv("environmental_bayesian_modeling/data/burke/data/input/GrowthClimateDataset.csv",header=TRUE)
burke.data <- burke.data %>% drop_na(c('growthWDI','UDel_temp_popweight','UDel_precip_popweight'))
# TODO: remove countries with no climate data
# TODO: add gradual effects
countries <- burke.data[,1]
years <- burke.data[,2]
gdp <- burke.data[,11]
temp <- burke.data[,28]
precip <- burke.data[,29]
grad_effects <- transpose(burke.data[, grep(pattern ='X_yi_*', names(burke.data))])
grad_effects_2 <- transpose(burke.data[, grep(pattern ='X_y2_*', names(burke.data))])
data_len <- dim(burke.data)[1]
num_countries <- length(unique(countries))
num_years <- length(unique(years))
grad_effects_len <- dim(grad_effects)[1]
countries_encoded <- as.integer(factor(countries))
years_encoded = as.integer(factor(years))
reg_grad_effects <- matrix(0,data_len+1,grad_effects_len+1)
reg_grad_effects_2 <- matrix(0,data_len+1,grad_effects_len+1)
jags <- jags.model(
"environmental_bayesian_modeling/JAGS/burke_hierarchical_model.txt",
data = list(
'temp_x'=temp,
'precip_x'=precip,
'gdp_y'=gdp,
'n'=data_len,
'm'=num_countries,
'o'=num_years,
'p'=grad_effects_len,
'countries'=countries_encoded,
'year'=years_encoded,
'grad_effects_data'=grad_effects,
'grad_effects_2_data'=grad_effects_2,
'reg_grad_effects'=reg_grad_effects,
'reg_grad_effects_2'=reg_grad_effects_2
)
)
library(rjags)
library(coda)
library(tidyr)
library(data.table)
burke.data <- read.csv("environmental_bayesian_modeling/data/burke/data/input/GrowthClimateDataset.csv",header=TRUE)
burke.data <- burke.data %>% drop_na(c('growthWDI','UDel_temp_popweight','UDel_precip_popweight'))
# TODO: remove countries with no climate data
# TODO: add gradual effects
countries <- burke.data[,1]
years <- burke.data[,2]
gdp <- burke.data[,11]
temp <- burke.data[,28]
precip <- burke.data[,29]
grad_effects <- transpose(burke.data[, grep(pattern ='X_yi_*', names(burke.data))])
grad_effects_2 <- transpose(burke.data[, grep(pattern ='X_y2_*', names(burke.data))])
data_len <- dim(burke.data)[1]
num_countries <- length(unique(countries))
num_years <- length(unique(years))
grad_effects_len <- dim(grad_effects)[1]
countries_encoded <- as.integer(factor(countries))
years_encoded = as.integer(factor(years))
jags <- jags.model(
"environmental_bayesian_modeling/JAGS/burke_hierarchical_model.txt",
data = list(
'temp_x'=temp,
'precip_x'=precip,
'gdp_y'=gdp,
'n'=data_len,
'm'=num_countries,
'o'=num_years,
'p'=grad_effects_len,
'countries'=countries_encoded,
'year'=years_encoded
)
)
jags.output.coda <- coda.samples(
jags,
c(
'temp_gdp_coef',
'precip_gdp_coef',
'temp_gdp_coef_2',
'precip_gdp_coef_2'
),
10000
)
summary(jags.output.coda)
library(rjags)
library(coda)
library(tidyr)
library(data.table)
burke.data <- read.csv("environmental_bayesian_modeling/data/burke/data/input/GrowthClimateDataset.csv",header=TRUE)
burke.data <- burke.data %>% drop_na(c('growthWDI','UDel_temp_popweight','UDel_precip_popweight'))
# TODO: remove countries with no climate data
# TODO: add gradual effects
countries <- burke.data[,1]
years <- burke.data[,2]
gdp <- burke.data[,11]
temp <- burke.data[,28]
precip <- burke.data[,29]
grad_effects <- transpose(burke.data[, grep(pattern ='X_yi_*', names(burke.data))])
grad_effects_2 <- transpose(burke.data[, grep(pattern ='X_y2_*', names(burke.data))])
data_len <- dim(burke.data)[1]
num_countries <- length(unique(countries))
num_years <- length(unique(years))
grad_effects_len <- dim(grad_effects)[1]
countries_encoded <- as.integer(factor(countries))
years_encoded = as.integer(factor(years))
jags <- jags.model(
"environmental_bayesian_modeling/JAGS/burke_hierarchical_model.txt",
data = list(
'temp_x'=temp,
'precip_x'=precip,
'gdp_y'=gdp,
'n'=data_len,
'm'=num_countries,
'o'=num_years,
'p'=grad_effects_len,
'countries'=countries_encoded,
'year'=years_encoded
)
)
library(rjags)
library(coda)
library(tidyr)
library(data.table)
burke.data <- read.csv("environmental_bayesian_modeling/data/burke/data/input/GrowthClimateDataset.csv",header=TRUE)
burke.data <- burke.data %>% drop_na(c('growthWDI','UDel_temp_popweight','UDel_precip_popweight'))
# TODO: remove countries with no climate data
# TODO: add gradual effects
countries <- burke.data[,1]
years <- burke.data[,2]
gdp <- burke.data[,11]
temp <- burke.data[,28]
precip <- burke.data[,29]
grad_effects <- transpose(burke.data[, grep(pattern ='X_yi_*', names(burke.data))])
grad_effects_2 <- transpose(burke.data[, grep(pattern ='X_y2_*', names(burke.data))])
data_len <- dim(burke.data)[1]
num_countries <- length(unique(countries))
num_years <- length(unique(years))
grad_effects_len <- dim(grad_effects)[1]
countries_encoded <- as.integer(factor(countries))
years_encoded = as.integer(factor(years))
jags <- jags.model(
"environmental_bayesian_modeling/JAGS/burke_hierarchical_model.txt",
data = list(
'temp_x'=temp,
'precip_x'=precip,
'gdp_y'=gdp,
'n'=data_len,
'm'=num_countries,
'o'=num_years,
'p'=grad_effects_len,
'countries'=countries_encoded,
'year'=years_encoded
)
)
load("~/environmental_bayesian_modeling/models/burke_reproduction_unscaled.Rdata")
jags.output.coda
mean(jags.output.coda$precip)
jags.output.coda[[1]]
jags.output.coda[[1]][1]
jags.output.coda[[1]][2]
jags.output.coda[[1]][10000]
jags.output.coda[[1]][10001]
jags.output.coda[[1]][10000]
jags.output.coda[[1]][100000]
library(rjags)
library(coda)
library(tidyr)
library(data.table)
burke.data <- read.csv("environmental_bayesian_modeling/data/burke/data/input/GrowthClimateDatasetTruncated.csv",header=TRUE)
burke.data <- burke.data %>% drop_na(c('growthWDI','UDel_temp_popweight','UDel_precip_popweight'))
# TODO: remove countries with no climate data
# TODO: add gradual effects
countries <- burke.data[,1]
years <- burke.data[,2]
gdp <- burke.data[,11]
temp <- burke.data[,28]
precip <- burke.data[,29]
grad_effects <- transpose(burke.data[, grep(pattern ='X_yi_*', names(burke.data))])
grad_effects_2 <- transpose(burke.data[, grep(pattern ='X_y2_*', names(burke.data))])
data_len <- dim(burke.data)[1]
num_countries <- length(unique(countries))
num_years <- length(unique(years))
grad_effects_len <- dim(grad_effects)[1]
countries_encoded <- as.integer(factor(countries))
years_encoded = as.integer(factor(years))
scaled_temp <- scale(temp)
scaled_precip <- scale(precip)
scaled_gdp <- scale(gdp)
jags <- jags.model(
"environmental_bayesian_modeling/JAGS/burke_hierarchical_model_covariate_deterministic.txt",
data = list(
'temp_x'=as.numeric(scaled_temp),
'precip_x'=as.numeric(scaled_precip),
'gdp_y'=as.numeric(scaled_gdp),
'n'=data_len,
'm'=num_countries,
'o'=num_years,
'p'=grad_effects_len,
'countries'=countries_encoded,
'year'=years_encoded,
'grad_effects_data'=grad_effects,
'grad_effects_2_data'=grad_effects_2
)
)
library(rjags)
library(coda)
library(tidyr)
library(data.table)
burke.data <- read.csv("environmental_bayesian_modeling/data/burke/data/input/GrowthClimateDatasetTruncated.csv",header=TRUE)
burke.data <- burke.data %>% drop_na(c('growthWDI','UDel_temp_popweight','UDel_precip_popweight'))
# TODO: remove countries with no climate data
# TODO: add gradual effects
countries <- burke.data[,1]
years <- burke.data[,2]
gdp <- burke.data[,11]
temp <- burke.data[,28]
precip <- burke.data[,29]
grad_effects <- transpose(burke.data[, grep(pattern ='X_yi_*', names(burke.data))])
grad_effects_2 <- transpose(burke.data[, grep(pattern ='X_y2_*', names(burke.data))])
data_len <- dim(burke.data)[1]
num_countries <- length(unique(countries))
num_years <- length(unique(years))
grad_effects_len <- dim(grad_effects)[1]
countries_encoded <- as.integer(factor(countries))
years_encoded = as.integer(factor(years))
scaled_temp <- scale(temp)
scaled_precip <- scale(precip)
scaled_gdp <- scale(gdp)
jags <- jags.model(
"environmental_bayesian_modeling/JAGS/burke_hierarchical_model_covariate_deterministic.txt",
data = list(
'temp_x'=as.numeric(scaled_temp),
'precip_x'=as.numeric(scaled_precip),
'gdp_y'=as.numeric(scaled_gdp),
'n'=data_len,
'm'=num_countries,
'o'=num_years,
'p'=grad_effects_len,
'countries'=countries_encoded,
'year'=years_encoded,
'grad_effects_data'=grad_effects,
'grad_effects_2_data'=grad_effects_2
)
)
library(rjags)
library(coda)
library(tidyr)
library(data.table)
burke.data <- read.csv("environmental_bayesian_modeling/data/burke/data/input/GrowthClimateDatasetTruncated.csv",header=TRUE)
burke.data <- burke.data %>% drop_na(c('growthWDI','UDel_temp_popweight','UDel_precip_popweight'))
# TODO: remove countries with no climate data
# TODO: add gradual effects
countries <- burke.data[,1]
years <- burke.data[,2]
gdp <- burke.data[,11]
temp <- burke.data[,28]
precip <- burke.data[,29]
grad_effects <- transpose(burke.data[, grep(pattern ='X_yi_*', names(burke.data))])
grad_effects_2 <- transpose(burke.data[, grep(pattern ='X_y2_*', names(burke.data))])
data_len <- dim(burke.data)[1]
num_countries <- length(unique(countries))
num_years <- length(unique(years))
grad_effects_len <- dim(grad_effects)[1]
countries_encoded <- as.integer(factor(countries))
years_encoded = as.integer(factor(years))
scaled_temp <- scale(temp)
scaled_precip <- scale(precip)
scaled_gdp <- scale(gdp)
jags <- jags.model(
"environmental_bayesian_modeling/JAGS/burke_hierarchical_model_covariate_deterministic.txt",
data = list(
'temp_x'=as.numeric(scaled_temp),
'precip_x'=as.numeric(scaled_precip),
'gdp_y'=as.numeric(scaled_gdp),
'n'=data_len,
'm'=num_countries,
'o'=num_years,
'p'=grad_effects_len,
'countries'=countries_encoded,
'year'=years_encoded,
'grad_effects_data'=grad_effects,
'grad_effects_2_data'=grad_effects_2
)
)
View(burke.data)
load("~/environmental_bayesian_modeling/models/nature_reproduction/burke_reproduction_scaled_deterministic_covariates_4_chains.RData")
temp_coef <- jags.output.coda[[1]][,5]
temp_coef_2 <- jags.output.coda[[1]][,6]
temp_denominator <- sapply(temp_coef_2, function(i){i*-2})
temp_vertex <- temp_coef / temp_denominator
temp_observed_mean <- attributes(scaled_temp)$`scaled:center`
temp_observed_sd <- attributes(scaled_temp)$`scaled:scale`
unscaled_temp_vertex <- (temp_vertex * temp_observed_sd) + temp_observed_mean
print(mean(unscaled_temp_vertex))
print(sd(unscaled_temp_vertex))
temp_coef <- jags.output.coda[[2]][,5]
jags.output.coda
result <- c("test")
save.image(file='environmental_bayesian_modeling/yoursession.RData')
load("~/environmental_bayesian_modeling/yoursession.RData")
load("~/environmental_bayesian_modeling/yoursession.RData")
load("~/environmental_bayesian_modeling/models/nature_reproduction/burke_missing_data_imputed_hierarchical_country_priors.RData")
temp_coef <- as.vector(rbind(jags.output.coda[[1]][,5],jags.output.coda[[2]][,5],jags.output.coda[[3]][,5],jags.output.coda[[4]][,5]))
temp_coef_2 <- as.vector(rbind(jags.output.coda[[1]][,6],jags.output.coda[[2]][,6],jags.output.coda[[3]][,6],jags.output.coda[[4]][,6]))
temp_denominator <- sapply(temp_coef_2, function(i){i*-2})
temp_vertex <- temp_coef / temp_denominator
temp_observed_mean <- attributes(scaled_temp)$`scaled:center`
temp_observed_sd <- attributes(scaled_temp)$`scaled:scale`
unscaled_temp_vertex <- (temp_vertex * temp_observed_sd) + temp_observed_mean
print(mean(unscaled_temp_vertex))
print(sd(unscaled_temp_vertex))
coda::gelman.diag(jags.output.coda)
plot(jags.output.coda)
coda::gelman.plot(jags.output.coda)
temp_coef <- jags.output.coda[[1]][,5]
temp_coef_2 <- jags.output.coda[[1]][,6]
temp_denominator <- sapply(temp_coef_2, function(i){i*-2})
temp_vertex <- temp_coef / temp_denominator
temp_observed_mean <- attributes(scaled_temp)$`scaled:center`
temp_observed_sd <- attributes(scaled_temp)$`scaled:scale`
unscaled_temp_vertex <- (temp_vertex * temp_observed_sd) + temp_observed_mean
print(mean(unscaled_temp_vertex))
print(sd(unscaled_temp_vertex))
temp_coef <- jags.output.coda[[2]][,5]
> temp_coef_2 <- jags.output.coda[[2]][,6]
temp_coef <- jags.output.coda[[2]][,5]
temp_coef_2 <- jags.output.coda[[2]][,6]
temp_denominator <- sapply(temp_coef_2, function(i){i*-2})
temp_vertex <- temp_coef / temp_denominator
temp_observed_mean <- attributes(scaled_temp)$`scaled:center`
temp_observed_sd <- attributes(scaled_temp)$`scaled:scale`
unscaled_temp_vertex <- (temp_vertex * temp_observed_sd) + temp_observed_mean
print(mean(unscaled_temp_vertex))
coda::effective_size(jags.output.coda)
effective_size(jags.output.coda)
coda::effectiveSize(jags.output.coda)
jags.output.coda <- thin(jags.output.coda,2)
jags.output.coda <- coda::thin(jags.output.coda,2)
jags.output.coda
jags.output.coda[[1]]
load("~/environmental_bayesian_modeling/models/nature_reproduction/burke_missing_data_imputed_hierarchical_country_priors.RData")
jags.outout.coda
print(jags.output.coda)
thinned_chain <- coda::thin(jags.output.coda)
print(thinned_chain)
thinned_chain <- jags.output.coda[seq(1, length(jags.output.coda), by = 2), ]
print(thinned_chain)
thinned_chain <- jags.output.coda[seq(1, 1000, by = 2), ]
thinned_chain
coda::gelman.diag(jags.output.coda)
coda::gelman.diag(thinned_chain)
thinned_chain
jags.output.coda
mcmc.list(thinned_chain)
thinned_chain <- coda::window(jags.output.coda, 0, 1000, 2)
thinned_chain <- window(jags.output.coda, 0, 1000, 2)
thinned_chain <- window(jags.output.coda[[1]], 0, 1000, 2)
thinned_chain <- coda::window.mcmc(jags.output.coda, 0, 1000, 2)
thinned_chain <- coda::window.mcmc(jags.output.coda, thin=2)
thinned_chain <- window(jags.output.coda, thin=2)
thinned_chain
coda::gelman.diag(thinned_chain)
coda::gelman.diag(jags.output.coda)
thinned_chain <- window(jags.output.coda, thin=10)
coda::gelman.diag(thinned_chain)
load("~/environmental_bayesian_modeling/models/nature_reproduction/burke_reproduction_scaled_deterministic_covariates_4_chains.RData")
temp_coef <- as.vector(rbind(jags.output.coda[[1]][,5],jags.output.coda[[2]][,5],jags.output.coda[[3]][,5],jags.output.coda[[4]][,5]))
temp_coef_2 <- as.vector(rbind(jags.output.coda[[1]][,6],jags.output.coda[[2]][,6],jags.output.coda[[3]][,6],jags.output.coda[[4]][,6]))
temp_denominator <- sapply(temp_coef_2, function(i){i*-2})
temp_vertex <- temp_coef / temp_denominator
temp_observed_mean <- attributes(scaled_temp)$`scaled:center`
temp_observed_sd <- attributes(scaled_temp)$`scaled:scale`
unscaled_temp_vertex <- (temp_vertex * temp_observed_sd) + temp_observed_mean
print(mean(unscaled_temp_vertex))
print(sd(unscaled_temp_vertex))
coda::gelman.diag(jags.output.coda)
coda::effective_size(jags.output.coda)
load("~/environmental_bayesian_modeling/models/nature_reproduction/burke_missing_data_imputed_hierarchical_country_priors.RData")
temp_coef <- as.vector(rbind(jags.output.coda[[1]][,5],jags.output.coda[[2]][,5],jags.output.coda[[3]][,5],jags.output.coda[[4]][,5]))
temp_coef_2 <- as.vector(rbind(jags.output.coda[[1]][,6],jags.output.coda[[2]][,6],jags.output.coda[[3]][,6],jags.output.coda[[4]][,6]))
temp_denominator <- sapply(temp_coef_2, function(i){i*-2})
temp_vertex <- temp_coef / temp_denominator
temp_observed_mean <- attributes(scaled_temp)$`scaled:center`
temp_observed_sd <- attributes(scaled_temp)$`scaled:scale`
unscaled_temp_vertex <- (temp_vertex * temp_observed_sd) + temp_observed_mean
print(mean(unscaled_temp_vertex))
print(sd(unscaled_temp_vertex))
coda::gelman.diag(jags.output.coda)
coda::effective_size(jags.output.coda)
plot(jags.output.coda)
ls
getwd()
setwd("environmental_bayesian_modeling/burke")
setwd("environmental_bayesian_modeling/data/burke")
burke_data <- read.csv("data/input/data/GrowthClimateDataset_2_years_withheld.csv")
burke_data <- read.csv("data/input/GrowthClimateDataset_2_years_withheld.csv")
f <- as.formula(growthWDI ~ UDel_temp_popweight + UDel_temp_popweight_2 + UDel_precip_popweight + UDel_precip_popweight_2 | iso + year | 0 | iso)
reg <- felm(f, burke_data, Nboot=100)
library(lfe)
reg <- felm(f, burke_data, Nboot=100)
reg
reg$boot
